#!/bin/bash -e

dir="$(dirname "${BASH_SOURCE[0]}")/.."

kubectl config set-cluster local-apiserver \
 --certificate-authority="$dir/gen/ca/ca-cert.pem" \
 --embed-certs=true \
 --server=https://127.0.0.1:6443 \
 --kubeconfig=kubeconfig

kubectl config set-credentials admin \
 --client-certificate="$dir/gen/kube/client/cert.pem" \
 --client-key="$dir/gen/kube/client/key.pem" \
 --embed-certs=true \
 --kubeconfig=kubeconfig

kubectl config set-context default \
 --cluster=local-apiserver \
 --user=admin \
 --kubeconfig=kubeconfig

kubectl config use-context default --kubeconfig=kubeconfig
